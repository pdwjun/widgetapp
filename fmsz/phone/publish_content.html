<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport"
          content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="css/project/ui-btn-v3.css">
    <link rel="stylesheet" href="css/project/ui-res-v3.css">
    <link rel="stylesheet" href="css/project/ui-input-v3.css">
    <link rel="stylesheet" href="css/project/ui-color-v3.css">
    <link rel="stylesheet" href="css/ui-box.css">
    <link rel="stylesheet" href="css/ui-base.css">
    <link rel="stylesheet" href="css/project/ui-list.css">
    <link rel="stylesheet" href="css/project/style.css">
    <link rel="stylesheet" href="publish_content/css/main.css">
    <script src="js/zy_control.js"></script>
    <script src="js/zy_click.js"></script>
    <script src="js/zy_tmpl.js"></script>
    <script src="js/base64.js"></script>
    <script src="js/main.js"></script>
    <script src="js/zy_json.js"></script>
    <script src="publish_content/js/publish.js"></script>
</head>
<body class="um-vp c-gra1" ontouchstart>
<div class="ub ub-ver">

    <div class="ub ub-ver uinn-a1 ub-f1">
        <div class="uba b-gra2 c-wh" style="-webkit-border-radius: 0.5em;">
            <ul ontouchstart="zy_touch('btn-act')" class="ubb ub b-gra2 t-bla ub-ac uinn-a9">
                <li class="tx-r ulev-app1 t-gra-FS1 right ">
                    <!--下拉列表开始-->
                    <div class="ub t-bla uinn">
                        <div class="ub-f1 ub uba c-wh b-gra  sel">
                            <div class="ub-f1 ut-s uinn ulev-1 tx-l t-gra ulh-sel">选择标签</div>
                            <div class="ubl b-gra c-06 umw2 ub ub-pc ub-ac">
                                <div class="ub-img umw1 umh1 res3"></div>
                            </div>
                            <select name="cate" selectedindex="0" id="cate" onchange="zy_selectmenu(this.id)">

                            </select>
                        </div>
                    </div>
                    <!--下拉列表结束-->


                </li>

            </ul>
            <ul ontouchstart="zy_touch('btn-act')" class="ubb ub b-gra2 t-bla ub-ac uinn-a9">
                <li class="tx-r ulev-app1 t-gra-FS1 right"><input placeholder="标题输入" id="title" type="text"
                                                                  class="uinn msg_title"></li>

            </ul>

            <ul ontouchstart="zy_touch('btn-act')" class="ubb ub b-gra2 t-bla ub-ac uinn-a9">

                <li class="tx-r ulev-app1 t-gra-FS1 right">
                    <textarea placeholder="请输入正文" id="content" type="text" class="uinn msg_content"></textarea>
                </li>
            </ul>

        </div>
    </div>
</div>
<div class="ub ub-ver uinn-a1 ub-f1">

    <div class="ub uba b-gra2 c-wh uinn">
        <div id="uploadimage"></div>
        <!--按钮开始-->
        <div class="btn uc-a photo umh1-7 umw1-7 ub-img4 uwh-tBtn" onclick="upPhoto();"></div>
        <!--按钮结束-->
        <div class="ub-f1" id="photolist">

        </div>

    </div>

</div>


<div class="ub ub-ac ub-pc umar-a c-btn uc-a1" ontouchstart="zy_touch('btn-act1')" onclick="save();">
    <input type="hidden" id="photo" value="" name="photo">

    <div class=" ub ub-ac ub-pc t-wh uinnh5">保存</div>
</div>
</body>
<script>
    // 点击按钮返回类型值
    function onClickItem(dateType) {
        /*dateType 数据类型是string，如效果图，拍照是0，从相册选择是1，依次叠加，如果是取消按钮, 返回-1*/
        alert("itemIndex:" + dateType);
    }
    function callback(data) {
        var tmpl = '<option value="${id}">${name}</option>'
        var s = zy_tmpl(tmpl, data, zy_tmpl_count(data));

        $$("cate").innerHTML = s;


    }

    var file_c = 0;
    zy_init();
    window.uexOnload = function (type) {
        if (!type) {
            uexWindow.setBounce("1");
            uexWindow.showBounceView("0", "rgba(255,255,255,0)", "0");
            uexWindow.showBounceView("1", "rgba(255,255,255,0)", "0");
        }
        //拍照回调
        uexCamera.cbOpen = function (opCode, dataType, data) {

            upload(data);
        }
        //相册回调
        uexImageBrowser.cbPick = function (opCode, dataType, data) {
            upload(data);
        }
        uexUploaderMgr.onStatus = function (opCode, fileSize, percent, serverPath, status) {
            switch (status) {
                case 0:
                    $toast("上传进度：" + percent + "%");

                    break;
                case 1:
                    $closeToast();

                    $toast("上传成功", 2000);
                    var oImg = document.createElement('img');
                    oImg.setAttribute('src', 'http://meibao.local'+serverPath);
                    oImg.setAttribute('alt', 'na');
                    oImg.style.width = '3.75em';
                    oImg.style.margin = '0.5em';
                    oImg.style.height = '3.75em';
                    var uploaded = document.createElement('input');
                    uploaded.type = 'hidden';
                    uploaded.name = 'name_'+file_c;

                    file_c += 1;
                    $$("uploadimage").appendChild(oImg);
                    $$("uploadimage").appendChild(uploaded);
                    uexUploaderMgr.closeUploader(1);

                    break;
                case 2:
                    $closeToast();
                    $toast("上传失败", 1000);
                    uexUploaderMgr.closeUploader(1);
                    break;
            }
        }

        getCate();
        uexWindow.cbActionSheet = function (opId, dataType, data) {
            //console.log("选择的按钮在数组中的下标为："+data);
            var i = parseInt(data);
            switch (i) {
                case  0:
                    //拍照
                    uexCamera.open();
                    break;
                case 1:
                    //相册
                    uexImageBrowser.pick();
                    break;


            }
        }
    }

    function test(data) {

        setLocVal('mid', data);
        openNewWin('msg', 'msg.html');
    }
    function saveBack(data) {
        if (data == 0) {
            $toast("发布失败", 1000);
        } else {
            $toast("发布成功", 1000);
            window.setTimeout(test(data), 3000);
        }
    }

    function save() {
//	 var b64 = new Base64();
//	var cid= $$("cate").value;
//	var title=encodeURIComponent(b64.encode($$("title").value));
//	var content= encodeURIComponent(b64.encode($$("content").value));
//	var photo = encodeURIComponent(b64.encode($$("photo").value));
        var b64 = new Base64();
        var cid = $$("cate").value;
        var title = encodeURIComponent($$("title").value);
        var content = encodeURIComponent($$("content").value);
        var photo = encodeURIComponent($$("photo").value);
        var uid = getLocVal('uid');
        savedo(cid, title, content, photo, uid);

    }
    function upPhoto() {
        uexWindow.actionSheet("上传图片", "取消", ["手机拍照", "相册上传"]);

    }

</script>
</html>