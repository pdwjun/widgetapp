<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/ui-base.css">
	    <link rel="stylesheet" href="css/ui-box.css">
		<link rel="stylesheet" href="css/project/style.css">
		<link rel="stylesheet" href="comment_content/css/main.css">
	    <script src="js/zy_control.js"></script>
	    <script src="js/zy_click.js"></script>
		<script src="js/main.js"></script>
	   <script src="js/base64.js"></script>
       <script src="js/zy_json.js"></script>
	   <script src="comment_content/js/main.js"></script>
    </head>
    <body class="um-vp c-wh" ontouchstart>
        <div class="ub-f1 tx-l ub ub-ver c-wh">
            <div class="ub uba b-gra uc-a1 umar-a ub-ver">

                <div class="ub ub-ac">
                
                    <div class="ub-f1 uinput uinn">

						 <input  placeholder="输入评论内容" name="content" class="uinn" id="content">
                    </div>
                </div>
				<div class="uinn" id="photolist">
                      <div class="upphoto" onclick="upPhoto();"></div>
					
                </div>
			</div>
            <div class="ub ub-ac ub-pc umar-a c-org uc-a1">
            	 <input type="hidden" id="photo" value="" name="photo">
                <div ontouchstart="zy_touch('btn-act1')" onclick="publish();" class="uc-a ub ub-ac ub-pc t-wh uinnh5">发布评论</div>
			</div>


    	</div>
    </body>
    <script>
    	
 function callback(data){
	  if(data==1){
	  	 // $toast('发布评论成功',1000);  	
		 var id =getLocVal('houseid');
	 //uexWindow.evaluatePopoverScript('viewhouse','content',"loades();");
	      uescript('viewhouse','loades()');
		 uescript('comment','winClose()');
		
	  }else{
	  	  $toast('发布评论失败',1000);  
	  }
	
      }
    	zy_init();
		window.uexOnload = function(type){
			  if(!type){
		        uexWindow.setBounce("1");
		        uexWindow.showBounceView("0", "rgba(255,255,255,0)", "0");
                 uexWindow.showBounceView("1", "rgba(255,255,255,0)", "0");
	          }
		 //拍照回调
	  uexCamera.cbOpen=function(opCode, dataType, data){
		 	  upload(data);
	      }
	 //相册回调
	  uexImageBrowser.cbPick = function(opCode, dataType, data){
	 	     upload(data);
	        }
			
	uexWindow.cbActionSheet=function(opId,dataType,data){
      //console.log("选择的按钮在数组中的下标为："+data);
	  var i = 	parseInt(data);
      switch(i){
	 	case  0:
		 //拍照
		   uexCamera.open();
		break;	
		case 1:		
		//相册
		uexImageBrowser.pick();
		break;
	
	 }
    }
			
	uexUploaderMgr.onStatus = function(opCode, fileSize, percent, serverPath, status){
                    switch (status) {
                        case 0:
						   $toast( "上传进度：" + percent + "%");
                        
                            break;
                        case 1:
						 $closeToast();

					   $$('photolist').innerHTML='<div class="cover" style="background-image:url('+serverPath+');" ></div>'+ $$('photolist').innerHTML;
					    if($$('photo').value==''){
							  $$('photo').value= serverPath;
						}else{
							  $$('photo').value= $$('photo').value+'|'+serverPath;
						}
					  
						   $toast("上传成功",2000);
                            uexUploaderMgr.closeUploader(1);
                            break;
                        case 2:
						  $closeToast();
                            $toast("上传失败",1000);
                            uexUploaderMgr.closeUploader(1);
                            break;
                    }
                }		  
		}
    function upPhoto(){
        uexWindow.actionSheet("上传图片","取消",["手机拍照","相册上传"]);
	
     }	
	 
	 function publish(){
	 	var b64 = new Base64();
	 	var id = getLocVal('houseid');
		var uid = getLocVal('uid');
	 	var content = encodeURIComponent(b64.encode($$("content").value));
		var photo =encodeURIComponent(b64.encode($$("photo").value));

		dopublish(id,content,photo,uid);
	 }	
    </script>
</html>
